{% extends 'layout.html' %}
{% block content %}
<!-- ############ PAGE START-->
<div class="padding">
  <div class="box">
    <div class="box-header">
      <h3>{{subtitle}}</h3>
    </div>
    <div class="box-body">
      <div class="row p-a">
        <div class="col-sm-5">
          <a href="#" data-toggle="modal" data-target="#project-modal" class="btn btn-outline b-primary text-primary">Add New Project</a>
        </div>
      </div>
      <div class="table-responsive">
        <table id="projects-overview" class="table table-striped b-t b-b dataTable no-footer" ui-jp="projects">
          <thead>
          <tr>
            <th></th>
            <th>Project Nr</th>
            <th>Community</th>
            <th>Street</th>
            <th>House Nr</th>
            <th>Finished/All</th>
            <th data-sort-ignore="true">Project Types</th>
            <th style="width:20px;" data-sort-ignore="true"></th>
            <th style="width:20px;" data-sort-ignore="true"></th>
          </tr>
          </thead>
          <tbody>
          {% for project in projects %}
          <tr>
            <td class="details-control"></td>
            <td>{{project.id}}</td>
            <td>{{project.community}}</td>
            <td>{{project.street}}</td>
            <td>{{project.housenr}}</td>
            <td>{{project.zipcode}}</td>
            <td>
              <div class="form-group row">
              <label class="col-md-1 form-control-label md-check">
              <input type="checkbox" {% if project.contract_types.electric >0 %} checked {% endif %}><i class="red"></i>
              </label>
              <label class="col-md-1 form-control-label md-check">
              <input type="checkbox" {% if project.contract_types.water >0 %} checked {% endif %}><i class="green"></i>
              </label>
              <label class="col-md-1 form-control-label md-check">
              <input type="checkbox" {% if project.contract_types.light >0 %} checked {% endif %}><i class="blue"></i>
              </label>
              <label class="col-md-1 form-control-label md-check">
              <input type="checkbox" {% if project.contract_types.telecom >0 %} checked {% endif %}><i class="orange"></i>
              </label>
              <label class="col-md-1 form-control-label md-check">
              <input type="checkbox" {% if project.contract_types.gas >0 %} checked {% endif %}><i class="yellow"></i>
              </label>
              <label class="col-md-1 form-control-label md-check">
              <input type="checkbox" {% if project.contract_types.others >0 %} checked {% endif %}><i class="grey"></i>
              </label>
              </div>
            </td>
            <td>
              <a href="#" data-toggle="modal" data-target="#contract-basic-modal" data-project="{{project|json}}"><i class="material-icons md-24">&#xe03b;</i></a>
            </td>
            <td>
              <a href="#" data-toggle="modal" data-target="#project-modal" data-project="{{project|json}}"><i class="material-icons md-24">&#xe3c9;</i></a>
            </td>
          </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>


<!-- add and edit project modal -->
{% include 'modal_project.html' %}

<!-- add and edit contract basic modal -->
{% include 'modal_contract_basic.html' %}

<!-- add and edit contract basic modal -->
{% include 'modal_contract_building_permissions.html' %}

<!-- add and edit contract basic modal -->
{% include 'modal_contract_building.html' %}

<!-- add and edit contract basic modal -->
{% include 'modal_contract_ofw.html' %}

<!-- add and edit contract basic modal -->
{% include 'modal_contract_invoices.html' %}


<iframe id="file_tobe_printed" src="" hidden></iframe>

<!-- / .modal -->
<!-- ############ PAGE END-->

<script type="text/javascript">

function showEditState(id){
  $(id).removeAttr('hidden');
}

function hideEditState(id){
  $(id).attr('hidden', 'hidden');
}

function showInput(type){
  switch(type)
  {
  case 1://manager_name
    $('#manager_name_text').attr('hidden','hidden');
    $('#manager_name_input').removeAttr('hidden');
    $('#manager_name_edit_icon').attr('hidden','hidden');
    $('#manager_name_d').removeAttr('onmouseover');
    $('#manager_name_d').removeAttr('onmouseleave');
    break;
  case 2:
    $('#worker_name_text').attr('hidden','hidden');
    $('#worker_name_input').removeAttr('hidden');
    $('#worker_name_edit_icon').attr('hidden','hidden');
    $('#worker_name_d').removeAttr('onmouseover');
    $('#worker_name_d').removeAttr('onmouseleave');  
    break;
  }
}

function handleEnter(e, type){
  let keynum = 0;
  if(window.event) // IE
  {
    keynum = e.keyCode;
  }
  else if(e.which) // Netscape/Firefox/Opera
  {
    keynum = e.which;
  }
  if(keynum == 13) //enter press
  {
    switch(type)
    {
    case 1://manager_name
      var id = $('#manager_name_input').data('contractid');
      var value = $('#manager_name_input').val();
      postContractEditPartial(id, {'manager_name':value}, function(err){
        if(err) bootbox.alert('update failed!');
        else{
          bootbox.alert('update ok!');
          $('#manager_name_text').text(value);
        }
      });
      $('#manager_name_text').removeAttr('hidden','hidden');
      $('#manager_name_input').attr('hidden', 'hidden');
      $('#manager_name_d').attr('onmouseover', 'showEditState(manager_name_edit_icon)');
      $('#manager_name_d').attr('onmouseleave', 'hideEditState(manager_name_edit_icon)');
      break;
    case 2:
      var id = $('#worker_name_input').data('contractid');
      var value = $('#worker_name_input').val();
      postContractEditPartial(id, {'building_work.worker_name':value}, function(err){
        if(err) bootbox.alert('update failed!');
        else{
          bootbox.alert('update ok!');
          $('#worker_name_text').text(value);
        }
      });
      $('#worker_name_text').removeAttr('hidden','hidden');
      $('#worker_name_input').attr('hidden', 'hidden');
      $('#worker_name_d').attr('onmouseover', 'showEditState(worker_name_edit_icon)');
      $('#worker_name_d').attr('onmouseleave', 'hideEditState(worker_name_edit_icon)');    
      break;
    } 
  }
}

function postContractEditPartial (id, data, callback){
  url = '/contracts/edit/partial/'+id;
  var posting = $.post( url, data );
  posting.done(function( data ) {
    if(data!='ok') {
      let err = 'err';
      callback(err);
    }
    else
      callback(undefined);
  });
}

function printTemplate(id){
  url = '/contracts/print/'+id;
  var posting = $.post( url, {} );
  posting.done(function( data ) { 
    $('#file_tobe_printed').attr('src', data);
    //var iframe = document.getElementById('file_tobe_printed');
    //iframe.contentWindow.print();
    //alert(data);
    return;
    if(data!='ok') {
      let err = 'err';
      callback(err);
    }
    else
      callback(undefined);
  });  
}
</script>
<!-- ############ PAGE END-->
{% endblock %}