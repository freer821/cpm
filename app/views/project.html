{% extends 'layout.html' %}
{% block content %}
<!-- ############ PAGE START-->
<div class="padding">
  <div class="box">
    <div class="box-header">
      <h3>{{subtitle}}</h3>
    </div>
    <div class="box-body">
      <div class="row p-a">
        <div class="col-sm-5">
          <a href="#" data-toggle="modal" data-target="#project-modal" class="btn btn-outline b-primary text-primary" data-backdrop="static">Add New Project</a>
        </div>
      </div>
      <div class="table-responsive">
        <table id="projects-overview" class="table table-striped b-t b-b">
          <thead>
          <tr>
            <th style="width:52px;"> </th>
            <th style="min-width:100px;" data-toggle="true">Project Nr.</th>
            <th style="width:140px;">Community </th>
            <th style="min-width:190px;">Street </th>
            <th style="min-width:60px;">HsNr. </th>
            <th style="min-width:80px;max-width:80px;">finisched /All </th>
            <th style="max-width:175px;min-width:175px;width:175px;">Project Type </th>
            <th style="width:52px;"> </th>
            <th style="width:52px;"> </th>
          </tr>
          </thead>
          <tbody>
          {% for project in projects %}
          <tr id="{{project.id}}">
            <td class="details-control" style="width:52px;height:43px;min-width:52px;max-height:40px;max-width:52px;">
              <i class="glyphicon glyphicon-expand" style="font-size:19px;color:rgb(89,89,89);" onclick="showContracts('{{project.id}}')"></i>
              <i class="glyphicon glyphicon-collapse-down" style="font-size:19px;color:rgb(89,89,89);" onclick="hideContracts('{{project.id}}')"></i>
            </td>
            <td class="projectSchema.id" style="height:43px;min-width:100px;">{{project.id}} </td>
            <td class="projectSchema.community" style="min-width:140px;height:43px;">{{project.community}} </td>
            <td class="projectSchema.street" style="min-width:190px;height:43px;">{{project.street}} </td>
            <td class="projectSchema.housenr" style="min-width:60px;height:43px;padding-left:14px;">{{project.housenr}} </td>
            <td class="finished_overview" style="min-width:80px;padding-left:2%;max-width:80px;">{{project.contracts_status}}</td>
            <td class="projectSchema.contract_types" style="max-height:43px;background-position:top;background-size:contain;background-repeat:no-repeat;max-width:175px;min-width:175px;width:175px;">
              <div style="max-width:175px;min-width:175px;">
                {% if project.contract_types.electric %}
                <i class="fa fa-square projectSchema.contract_types.electric_true" style="width:21px;height:21px;font-size:21px;margin-right:6px;color:#b53f45;"></i>
                {% else %}
                <i class="fa fa-square-o projectSchema.contract_types.electric_false" style="width:21px;height:21px;font-size:21px;margin-right:6px;color:#b53f45;"></i>
                {% endif %}
                {% if project.contract_types.gas %}
                <i class="fa fa-square projectSchema.contract_types.gas_true" style="width:21px;height:21px;font-size:21px;margin-right:4px;color:#ffd000;"></i>
                {% else %}
                <i class="fa fa-square-o projectSchema.contract_types.gas_false" style="width:21px;height:21px;font-size:21px;margin-right:4px;color:#ffd000;"></i>
                {% endif %}
                {% if project.contract_types.water %}
                <i class="fa fa-square projectSchema.contract_types.water_true" style="width:21px;height:21px;font-size:21px;margin-right:6px;color:#3e6b7e;"></i>
                {% else %}
                <i class="fa fa-square-o projectSchema.contract_types.water_false" style="width:21px;height:21px;font-size:21px;margin-right:6px;color:#3e6b7e;"></i>
                {% endif %}
                {% if project.contract_types.light %}
                <i class="fa fa-square projectSchema.contract_types.light_true" style="width:21px;height:21px;font-size:21px;margin-right:6px;color:#91c0ab;"></i>
                {% else %}
                <i class="fa fa-square-o projectSchema.contract_types.light_false" style="width:21px;height:21px;font-size:21px;margin-right:6px;color:#91c0ab;"></i>
                {% endif %}
                {% if project.contract_types.telecom %}
                <i class="fa fa-square projectSchema.contract_types.telecom_true" style="width:21px;height:21px;font-size:21px;margin-right:4px;color:rgb(248,126,123);"></i>
                {% else %}
                <i class="fa fa-square-o projectSchema.contract_types.telecom_false" style="width:21px;height:21px;font-size:21px;margin-right:4px;color:rgb(248,126,123);"></i>
                {% endif %}
                {% if project.contract_types.others %}
                <i class="fa fa-square projectSchema.contract_types.others_true" style="width:21px;height:21px;font-size:21px;margin-right:0px;"></i>
                {% else %}
                <i class="fa fa-square-o projectSchema.contract_types.others_false" style="width:21px;height:21px;font-size:21px;margin-right:0px;"></i>
                {% endif %}
              </div>
            </td>
            <td class="edit_project" style="min-width:52px;max-width:52px;">
              <a href="#" data-toggle="modal" data-target="#project-modal" data-project="{{project|json}}"><i class="fa fa-pencil-square-o" style="font-size:22px;margin-left:4px;color:rgb(89,89,89);min-width:22px;"></i></a>
            </td>
            <td class="add_new_contract" style="min-width:52px;max-width:52px;">
              <a href="#" data-toggle="modal" data-target="#contract-basic-modal" data-project="{{project|json}}"><i class="fa fa-plus-square" style="font-size:21px;margin-left:6px;color:rgb(89,89,89);"></i></a>
            </td>
          </tr>
          <tr>
            <td id="{{project.id}}_contracts" colspan="9">
              <!-- 二级展开todo -->
            </td>
          </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>


<!-- add and edit project modal -->
{% include 'modal_project.html' %}

<!-- add and edit contract basic modal -->
{% include 'modal_contract_basic.html' %}

<!-- add and edit contract basic modal -->
{% include 'modal_contract_building_permissions.html' %}

<!-- add and edit contract basic modal -->
{% include 'modal_contract_building.html' %}

<!-- add and edit contract basic modal -->
{% include 'modal_contract_ofw.html' %}

<!-- add and edit contract basic modal -->
{% include 'modal_contract_invoices.html' %}

<!-- contract print modal -->
{% include 'modal_contract_print.html' %}

<iframe id="file_tobe_printed" src="" hidden></iframe>

<!-- / .modal -->
<!-- ############ PAGE END-->

<script type="text/javascript">

    $.getScript(  '/scripts/app/app_project.js', function() {
        console.log('laod app_project');
    });

    $.getScript(  '/scripts/app/app_com.js', function() {
        console.log('laod app_com');
    });

    $.getScript(  '/scripts/app/app_contract.js', function() {
        console.log('laod app_contract');
    });

function postContractEditPartial (id, data, callback){
  url = '/contracts/edit/partial/'+id;
  var posting = $.post( url, data );
  posting.done(function( data ) {
    if(data!='ok') {
      let err = 'err';
      callback(err);
    }
    else
      callback(undefined);
  });
}

function printTemplate(id){
  url = '/contracts/print/'+id;
  var posting = $.post( url, {} );
  posting.done(function( data ) { 
    $('#file_tobe_printed').attr('src', data);
    //var iframe = document.getElementById('file_tobe_printed');
    //iframe.contentWindow.print();
    //alert(data);
    return;
    if(data!='ok') {
      let err = 'err';
      callback(err);
    }
    else
      callback(undefined);
  });  
}
</script>
<!-- ############ PAGE END-->
{% endblock %}
