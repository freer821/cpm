{% extends 'layout.html' %}
{% block content %}
<!-- ############ PAGE START-->
<div class="padding">
  <div class="box">
    <div class="box-header">
      <h3>{{project_id}}</h3>
      <small>{{project_adr}}</small>
    </div>
    <div class="box-body">
      <div class="row">
        <div class="col-sm-3 col-lg-2">
          <div class="p-y">
            <div class="nav-active-border left b-primary">
              <ul class="nav nav-sm flex-column">
                <li class="nav-item">
                  <a id="basic_info" class="nav-link block active" href data-toggle="tab" data-target="#tab-1">Basic Info</a>
                </li>
                <li class="nav-item">
                  <a id="building" class="nav-link block" href data-toggle="tab" data-target="#tab-2">Building</a>
                </li>
                <li  class="nav-item">
                  <a id="building_permission" class="nav-link block" href data-toggle="tab" data-target="#tab-3">Building Permission</a>
                </li>
                <li class="nav-item">
                  <a id="ofw" class="nav-link block" href data-toggle="tab" data-target="#tab-4">OFW Status</a>
                </li>
                <li class="nav-item">
                  <a id="financial" class="nav-link block" href data-toggle="tab" data-target="#tab-5">financial accounting</a>
                </li>
                <li class="nav-item">
                  <a id="fibu" class="nav-link block" href data-toggle="tab" data-target="#tab-6">Fibu</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-sm-9 col-lg-10 light lt" style="padding-left: 0px; padding-right: 0px">
          <div class="tab-content pos-rlt">
            <div class="tab-pane active"  id="tab-1">
              <div class="p-a-md dker _600" >Basic Info</div>
              <form role="form" action="/contracts/edit/basic" class="p-a-md" method="post">
              
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-3 form-control-label">Customer</label>
                      <div class="col-md-9">
                        <input type="text" class="form-control" name="customer" value="{{contract.customer}}">
                      </div>
                    </div>   
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-3 form-control-label">Partner Name</label>
                      <div class="col-md-9">
                        <input type="text" class="form-control" name="partner_name" value="{{contract.partner_name}}">
                      </div>
                    </div>   
                  </div>
                </div>

                <div class="row">
                  <div class="col-sm-6">
                    <div class="form-group row">
                      <label class="col-sm-3 form-control-label">Project Nr</label>
                      <div class="col-sm-9">
                        <input type="text" class="form-control" name="project_nr" value="{{contract.project_nr}}">
                      </div>
                    </div>   
                  </div>
                  <div class="col-sm-6">
                    <div class="form-group row">
                      <label class="col-sm-3 form-control-label">SAP Nr</label>
                      <div class="col-sm-9">
                        <input type="text" class="form-control" name="sap_nr" value="{{contract.sap_nr}}">
                      </div> 
                    </div>  
                  </div>
                </div>

                <div class="row">
                  <div class="col-sm-6">
                    <div class="form-group row">
                      <label class="col-sm-3 form-control-label">Cost Code</label>
                      <div class="col-sm-9">
                        <input type="text" class="form-control" name="cost_code" value="{{contract.cost_code}}">
                      </div>
                    </div>   
                  </div>
                  <div class="col-sm-6">
                    <div class="form-group row">
                      <label class="col-sm-3 form-control-label">Manager Name</label>
                      <div class="col-sm-9">
                        <input type="text" class="form-control" name="manager_name" value="{{contract.manager_name}}">
                      </div> 
                    </div>  
                  </div>
                </div>

                <div class="row">
                  <div class="col-sm-6">
                    <div class="form-group row">
                      <label class="col-sm-3 form-control-label">Estimated Value</label>
                      <div class="col-sm-9">
                        <input type="text" class="form-control" name="estimated_value" value="{{contract.estimated_value}}">
                      </div>
                    </div>   
                  </div>
                  <div class="col-sm-6">
                    <div class="form-group row">
                      <label class="col-sm-3 form-control-label">Work Content</label>
                      <div class="col-sm-9">
                        <input type="text" class="form-control" name="work_content" value="{{contract.work_content}}">
                      </div> 
                    </div>  
                  </div>
                </div>


                <div class="row">
                  <div class="col-sm-6">
                    <div class="form-group row">
                      <label class="col-sm-3 form-control-label">Contract Delivery</label>
                      <div class='input-group date col-sm-9' ui-jp="datetimepicker" ui-options="{
                            format: 'DD-MM-YYYY',
                            icons: {
                              time: 'fa fa-clock-o',
                              date: 'fa fa-calendar',
                              up: 'fa fa-chevron-up',
                              down: 'fa fa-chevron-down',
                              previous: 'fa fa-chevron-left',
                              next: 'fa fa-chevron-right',
                              today: 'fa fa-screenshot',
                              clear: 'fa fa-trash',
                              close: 'fa fa-remove'
                            }
                          }">
                        <input type='text' class="form-control" name="contract_delivery" value="{{contract.contract_delivery | date('d-m-Y')}}">
                        <span class="input-group-addon">
                            <span class="fa fa-calendar"></span>
                        </span>
                      </div>
                    </div>   
                  </div>
                  <div class="col-sm-6">
                    <div class="form-group row">
                      <label class="col-sm-3 form-control-label">Doc Delivery</label>
                      <div class='input-group date col-sm-9' ui-jp="datetimepicker" ui-options="{
                            format: 'DD-MM-YYYY',
                            icons: {
                              time: 'fa fa-clock-o',
                              date: 'fa fa-calendar',
                              up: 'fa fa-chevron-up',
                              down: 'fa fa-chevron-down',
                              previous: 'fa fa-chevron-left',
                              next: 'fa fa-chevron-right',
                              today: 'fa fa-screenshot',
                              clear: 'fa fa-trash',
                              close: 'fa fa-remove'
                            }
                          }">
                        <input type='text' class="form-control" name="doc_delivery" value="{{contract.doc_delivery | date('d-m-Y')}}">
                        <span class="input-group-addon">
                            <span class="fa fa-calendar"></span>
                        </span>
                      </div>   
                    </div>
                  </div>
                </div>

                <div class="form-group row">
                  <label class="col-sm-3 form-control-label">Contract Type</label>
                  <div class="col-sm-9">
                    <div class="form-group row">
                      <label class="md-check col-sm-2 form-control-label">
                        <input type="checkbox" name="is_electric" {% if contract.contract_typ.electric %}checked{% endif %}>
                        <i class="red"></i>
                          electric
                      </label>
                      <label class="md-check col-sm-2 form-control-label">
                        <input type="checkbox" name="is_water" {% if contract.contract_typ.water %}checked{% endif %}>
                        <i class="green"></i>
                          water
                      </label>
                      <label class="md-check col-sm-2 form-control-label">
                        <input type="checkbox" name="is_gas" {% if contract.contract_typ.gas %}checked{% endif %}>
                        <i class="yellow"></i>
                          gas
                      </label>
                      <label class="md-check col-sm-2 form-control-label">
                        <input type="checkbox" name="is_telecom" {% if contract.contract_typ.telecom %}checked{% endif %}>
                        <i class="blue"></i>
                          telecom
                      </label>
                      <label class="md-check col-sm-2 form-control-label">
                        <input type="checkbox" name="is_light" {% if contract.contract_typ.light %}checked{% endif %}>
                        <i class="orange"></i>
                          light
                      </label>
                      <label class="md-check col-sm-2 form-control-label">
                        <input type="checkbox" name="is_others" {% if contract.contract_typ.others %}checked{% endif %}>
                        <i class="grey"></i>
                          others
                      </label>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-sm-4">
                    <div class="form-group row">
                      <label class="col-sm-2 form-control-label">A-Elt Nr</label>
                      <div class="col-sm-10">
                        <input type="text" class="form-control" name="electric_nr" value="{{contract.electric_nr}}">
                      </div>
                    </div>  
                  </div>
                  <div class="col-sm-4">
                    <div class="form-group row">
                      <label class="col-sm-2 form-control-label">A-W Nr</label>
                      <div class="col-sm-10">
                        <input type="text" class="form-control" name="water_nr" value="{{contract.water_nr}}">   
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-4">
                    <div class="form-group row">
                      <label class="col-sm-2 form-control-label">A-G Nr</label>
                      <div class="col-sm-10">
                        <input type="text" class="form-control" name="gas_nr" value="{{contract.gas_nr}}">  
                      </div>
                    </div> 
                  </div>
                </div>

                <div class="form-group row">
                  <label class="col-sm-3 form-control-label">Rot B</label>
                  <div class="col-sm-9">
                    <label class="ui-switch primary m-t-xs m-r">
                      <input type="checkbox" name="rot_b" {% if contract.rot_b %}checked{% endif %}>
                      <i></i>
                    </label>
                  </div>
                </div>

                <div class="form-group row">
                  <label class="col-sm-3 form-control-label">Bomb Existed</label>
                  <div class="col-sm-9">
                    <label class="ui-switch info m-t-xs m-r">
                      <input type="checkbox" name="isBombExisted" {% if contract.isBombExisted %}checked{% endif %}>
                      <i></i>
                    </label>
                  </div>
                </div>

                <div class="form-group row">
                  <label class="col-sm-3 form-control-label">Building Permission Activ?</label>
                  <div class="col-sm-9">
                    <label class="ui-switch primary m-t-xs m-r">
                      <input type="checkbox" name="is_building_permission" {% if contract.is_building_permission %}checked{% endif %}>
                      <i></i>
                    </label>
                  </div>
                </div>

                <div class="form-group row">
                  <label class="col-sm-3 form-control-label">Doc Location</label>
                  <div class="col-sm-9">
                    <div class="form-group row">
                      <label class="col-sm-2 form-control-label">Person</label>
                      <div class="col-sm-10">
                        <input type="text" class="form-control" name="person" value="{{contract.doc_location.person}}">  
                      </div>
                    </div> 
                    <div class="form-group row">
                      <label class="col-sm-2 form-control-label">Reason</label>
                      <div class="col-sm-10">
                        <input type="text" class="form-control" name="reason" value="{{contract.doc_location.reason}}">  
                      </div>
                    </div> 
                  </div>
                </div>
                <div class="form-group">
                  <label>Comment</label>
                  <input type="text" class="form-control" name="comment" value="{{contract.comment}}">
                </div>
                <input type="hidden" name="contract_id" value="{{contract.id}}">
                <button type="submit" class="btn btn-info m-t">Update</button>
              </form>
            </div>
            <div class="tab-pane" id="tab-2">
              <div class="p-a-md dker _600">Buliding</div>
              <form role="form" action="/contracts/edit/building" class="p-a-md" method="post">
                <div class="row">
                  <div class="col-sm-6">
                    <div class="form-group row">
                      <label class="col-sm-3 form-control-label">Plan Begin</label>
                      <div class='input-group date col-sm-9' ui-jp="datetimepicker" ui-options="{
                            format: 'DD-MM-YYYY',
                            icons: {
                              time: 'fa fa-clock-o',
                              date: 'fa fa-calendar',
                              up: 'fa fa-chevron-up',
                              down: 'fa fa-chevron-down',
                              previous: 'fa fa-chevron-left',
                              next: 'fa fa-chevron-right',
                              today: 'fa fa-screenshot',
                              clear: 'fa fa-trash',
                              close: 'fa fa-remove'
                            }
                          }">
                        <input type='text' class="form-control" id="plan_begin" name="plan_begin" value="{{contract.building_work.plan_begin | date('d-m-Y')}}">
                        <span class="input-group-addon">
                            <span class="fa fa-calendar"></span>
                        </span>
                      </div>
                    </div>   
                  </div>
                  <div class="col-sm-6">
                    <div class="form-group row">
                      <label class="col-sm-3 form-control-label">Plan End</label>
                      <div id="plan_end_div" class='input-group date col-sm-9' ui-jp="datetimepicker" ui-options="{
                            format: 'DD-MM-YYYY',
                            icons: {
                              time: 'fa fa-clock-o',
                              date: 'fa fa-calendar',
                              up: 'fa fa-chevron-up',
                              down: 'fa fa-chevron-down',
                              previous: 'fa fa-chevron-left',
                              next: 'fa fa-chevron-right',
                              today: 'fa fa-screenshot',
                              clear: 'fa fa-trash',
                              close: 'fa fa-remove'
                            }
                          }">
                        <input type='text' class="form-control" id="plan_end" name="plan_end" value="{{contract.building_work.plan_end | date('d-m-Y')}}">
                        <span class="input-group-addon">
                            <span class="fa fa-calendar"></span>
                        </span>
                      </div>   
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-3 form-control-label">Worker</label>
                      <div class="col-md-9">
                        <input type="text" class="form-control" name="worker_name" value="{{contract.building_work.worker_name}}">
                      </div>
                    </div>   
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-3 form-control-label">Working Month</label>
                      <div class="col-md-9">
                        <input type="text" class="form-control" name="working_months" value="{{contract.building_work.working_months}}">
                      </div>
                    </div>   
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-3 form-control-label">Status</label>
                      <div class="col-md-9">
                        <select class="form-control c-select" id="building_status" name="status">
                          <option disabled selected value> -- select an status -- </option>
                          <option value="00" {% if contract.building_work.status ==='00' %}selected{% endif %} >00- in der Vorbereitung</option>
                          <option value="01" {% if contract.building_work.status ==='01' %}selected{% endif %} >01- vorbereiten zu bauen</option>
                          <option value="02" {% if contract.building_work.status ==='02' %}selected{% endif %}>02- geplant in Bau</option>
                          <option value="03" {% if contract.building_work.status ==='03' %}selected{% endif %} >03- fertig gebaut, Mappe abzug</option>
                          <option value="04" {% if contract.building_work.status ==='04' %}selected{% endif %} >04- Tiefbau &amp; Montage erledigt</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">  
                <div class="col-md-6">
                  <div class="form-group row">
                    <label class="col-md-3 form-control-label">Procent</label>
                    <div class="col-md-9">
                      <div id="procent_completion" class="progress mt-2"></div>
                    </div>
                  </div>
                </div> 
              </div>
                <input type="hidden" name="contract_id" value="{{contract.id}}"/>
                <button type="submit" class="btn btn-info m-t">Update</button>
              </form>
            </div>
            <div class="tab-pane" id="tab-3">
              <div class="p-a-md dker _600">Building Permission</div>
              <div class="box">
                <div class="box-header">
                  <h3>Permission Lists</h3>
                </div>
                <div class="box-tool">
                  <ul class="nav">
                    <li class="nav-item inline">
                      <div class="input-group input-group-sm">
                      <input type="text" id="filter" class="form-control" placeholder="Search">
                    </div>
                    </li>
                    <li class="nav-item inline dropdown">
                      <a class="nav-link" data-toggle="dropdown">
                        <i class="material-icons md-18">&#xe5d4;</i>
                      </a>
                      <div class="dropdown-menu dropdown-menu-scale pull-right">
                        <a href="#" data-toggle="modal" data-target="#edit-permission" class="dropdown-item">Add new Permission</a>
                      </div>
                    </li>
                  </ul>
                </div>
                <table class="table m-b-none b-t" ui-jp="footable" data-filter="#filter" data-page-size="5">
                  <thead>
                      <tr>
                        <th>Type</th>
                        <th>Begin</th>
                        <th>End</th>
                        <th>Cost</th>
                        <th>Status</th>
                        <th style="width:20px;" data-sort-ignore="true"></th>
                        <th style="width:20px;" data-sort-ignore="true"></th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for permission in contract.building_permission %}
                        {% set delurl = '/contracts/'+contract.id+'/del/permission?id='+permission._id+'&project_id='+project_id+'&project_adr='+project_adr %}
                        <tr>
                        <td>{{permission.type}}</td>
                        <td>{{permission.begin | date('d-m-Y')}}</td>
                        <td>{{permission.end | date('d-m-Y')}}</td>
                        <td>{{permission.cost}}</td>
                        <td>{{permission.status}}</td>
                          <td>
                            <a href="#" data-toggle="modal" data-target="#edit-permission" data-permission="{{permission|json}}"><i class="material-icons md-24">&#xe3c9;</i></a>
                          </td>
                          <td>
                            <a href="#" data-href="{{delurl}}" data-toggle="modal" data-target="#del-item" data-item-tilte="{{permission.type}}""><i class="material-icons md-24">&#xe872;</i></a>
                          </td>
                        </tr>
                      {% endfor %}           
                    </tbody>
                    <tfoot class="hide-if-no-paging">
                    <tr>
                        <td colspan="5" class="text-center">
                            <ul class="pagination"></ul>
                        </td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
            <div class="tab-pane" id="tab-4">
              <div class="p-a-md dker _600">OFW Status</div>
              <form role="form" action="/contracts/edit/ofw" class="p-a-md" method="post">

                <div class="row">
                  <div class="col-sm-6">
                    <div class="form-group row">
                      <label class="col-sm-3 form-control-label">Worker Name</label>
                      <div class="col-sm-9">
                        <input type="text" class="form-control" name="worker_name" value="{{contract.ofw.worker_name}}">
                      </div>
                    </div>   
                  </div>
                  <div class="col-sm-6">
                    <div class="form-group row">
                      <label class="col-sm-3 form-control-label">Permission Number</label>
                      <div class="col-sm-9">
                        <input type="text" class="form-control" name="permission_nr" value="{{contract.ofw.permission_nr}}">
                      </div> 
                    </div>  
                  </div>
                </div>

                <div class="row">
                  <div class="col-sm-6">
                    <div class="form-group row">
                      <label class="col-sm-3 form-control-label">Delivery at</label>
                      <div class='input-group date col-sm-9' ui-jp="datetimepicker" ui-options="{
                            format: 'DD-MM-YYYY',
                            icons: {
                              time: 'fa fa-clock-o',
                              date: 'fa fa-calendar',
                              up: 'fa fa-chevron-up',
                              down: 'fa fa-chevron-down',
                              previous: 'fa fa-chevron-left',
                              next: 'fa fa-chevron-right',
                              today: 'fa fa-screenshot',
                              clear: 'fa fa-trash',
                              close: 'fa fa-remove'
                            }
                          }">
                        <input type='text' class="form-control" name="delivery" value="{{contract.ofw.delivery | date('d-m-Y')}}">
                        <span class="input-group-addon">
                            <span class="fa fa-calendar"></span>
                        </span>
                      </div>
                    </div>   
                  </div>
                  <div class="col-sm-6">
                    <div class="form-group row">
                      <label class="col-sm-3 form-control-label">Finished at</label>
                      <div class='input-group date col-sm-9' ui-jp="datetimepicker" ui-options="{
                            format: 'DD-MM-YYYY',
                            icons: {
                              time: 'fa fa-clock-o',
                              date: 'fa fa-calendar',
                              up: 'fa fa-chevron-up',
                              down: 'fa fa-chevron-down',
                              previous: 'fa fa-chevron-left',
                              next: 'fa fa-chevron-right',
                              today: 'fa fa-screenshot',
                              clear: 'fa fa-trash',
                              close: 'fa fa-remove'
                            }
                          }">
                        <input type='text' class="form-control" name="completion_at" value="{{contract.ofw.completion_at | date('d-m-Y')}}">
                        <span class="input-group-addon">
                            <span class="fa fa-calendar"></span>
                        </span>
                      </div>   
                    </div>
                  </div>
                </div>

                <div class="form-group row">
                  <label class="col-sm-3 form-control-label">OFW Type</label>
                  <div class="col-sm-9">
                    <div class="form-group row">
                      <label class="md-check col-sm-2 form-control-label">
                        <input type="checkbox" name="bausstr" {% if contract.ofw.typ.bausstr %}checked{% endif %}>
                        <i class="red"></i>
                          Baustrasse
                      </label>
                      <label class="md-check col-sm-2 form-control-label">
                        <input type="checkbox" name="fahrbahn" {% if contract.ofw.typ.fahrbahn %}checked{% endif %}>
                        <i class="green"></i>
                          Fahrbahn
                      </label>
                      <label class="md-check col-sm-2 form-control-label">
                        <input type="checkbox" name="fussweg" {% if contract.ofw.typ.fussweg %}checked{% endif %}>
                        <i class="yellow"></i>
                          Fussweg
                      </label>
                      <label class="md-check col-sm-2 form-control-label">
                        <input type="checkbox" name="bitu" {% if contract.ofw.typ.bitu %}checked{% endif %}>
                        <i class="blue"></i>
                          Bitu
                      </label>
                      <label class="md-check col-sm-2 form-control-label">
                        <input type="checkbox" name="pflaster" {% if contract.ofw.typ.pflaster %}checked{% endif %}>
                        <i class="orange"></i>
                          Pflaster
                      </label>
                      <label class="md-check col-sm-2 form-control-label">
                        <input type="checkbox" name="beton" {% if contract.ofw.typ.beton %}checked{% endif %}>
                        <i class="grey"></i>
                          Beton
                      </label>
                    </div>
                  </div>
                </div>

                <div class="form-group row">
                  <label class="col-sm-2 form-control-label">Ueberdicken</label>
                  <div class="col-md-1">
                    <input type='text' class="form-control" name="ueberdicken" value="{{contract.ofw.ueberdicken}}">
                  </div>
                  <label class="col-sm-9 form-control-label">CM</label>
                </div>   

                <div class="form-group row">
                  <label class="col-sm-2 form-control-label">Clean</label>
                  <div class="col-sm-10">
                    <label class="ui-switch primary m-t-xs m-r">
                      <input type="checkbox" name="clean" {% if contract.ofw.clean %}checked{% endif %} >
                      <i></i>
                    </label>
                  </div>
                </div>


                <div class="form-group row">
                  <label class="col-sm-2 form-control-label">acceptance</label>
                  <div class="col-sm-10">
                    <label class="ui-switch primary m-t-xs m-r">
                      <input type="checkbox" id="is_acceptanced" name="is_acceptanced" {% if contract.ofw.acceptance %}checked{% endif %}>
                      <i></i>
                    </label>
                  </div>
                </div>
                <div id="add_acceptance" class="row"></div>

                <div class="form-group row">
                  <label class="col-sm-2 form-control-label">Extern Company</label>
                  <div class="col-sm-10">
                    <label class="ui-switch primary m-t-xs m-r">
                      <input type="checkbox" id="is_extern_company" name="is_extern_company" {% if contract.ofw.extern_company %}checked{% endif %}">
                      <i></i>
                    </label>
                  </div>
                </div>

                <div id="add_extern_company" class="row"></div>

                <div class="form-group row">
                  <label class="col-md-3 form-control-label">OFW Status</label>
                  <div id="ofw_status" class="col-md-9 progress mb-4">
                  </div>
                </div>   

                <input type="hidden" name="contract_id" value="{{contract.id}}">
                <button type="submit" class="btn btn-info m-t">Update</button>
              </form>
            </div>
            <div class="tab-pane" id="tab-5">
              <div class="p-a-md dker _600">Financial Accounting</div>
              <div class="box">
                <div class="box-header">
                  <h3>Invocie Lists</h3>
                </div>
                <div class="box-tool">
                  <ul class="nav">
                    <li class="nav-item inline">
                      <div class="input-group input-group-sm">
                      <input type="text" id="filter" class="form-control" placeholder="Search">
                    </div>
                    </li>
                    <li class="nav-item inline dropdown">
                      <a class="nav-link" data-toggle="dropdown">
                        <i class="material-icons md-18">&#xe5d4;</i>
                      </a>
                      <div class="dropdown-menu dropdown-menu-scale pull-right">
                        <a href="#" data-toggle="modal" data-target="#edit-invocie" class="dropdown-item">Add new Invocie</a>
                      </div>
                    </li>
                  </ul>
                </div>
                <table class="table m-b-none b-t" ui-jp="footable" data-filter="#filter" data-page-size="5">
                  <thead>
                      <tr>
                        <th>Invocie Nr</th>
                        <th>Current value</th>
                        <th>Sum</th>
                        <th>Status</th>
                        <th style="width:20px;" data-sort-ignore="true"></th>
                        <th style="width:20px;" data-sort-ignore="true"></th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for invoice in contract.invoice %}
                        {% set delurl = '/contracts/'+contract.id+'/del/invoice?id='+invoice._id+'&project_id='+project_id+'&project_adr='+project_adr %}
                        <tr>
                        <td>{{invoice.rechnung_nr}}</td>
                        <td>{{invoice.current_value}}</td>
                        <td>{{invoice.sum}}</td>
                        <td>{{invoice.status}}</td>
                          <td>
                            <a href="#" data-toggle="modal" data-target="#edit-invocie" data-invocie="{{invoice|json}}"><i class="material-icons md-24">&#xe3c9;</i></a>
                          </td>
                          <td>
                            <a href="#" data-href="{{delurl}}" data-toggle="modal" data-target="#del-item" data-item-tilte="{{invoice.rechnung_nr}}""><i class="material-icons md-24">&#xe872;</i></a>
                          </td>
                        </tr>
                      {% endfor %}           
                    </tbody>
                    <tfoot class="hide-if-no-paging">
                    <tr>
                        <td colspan="5" class="text-center">
                            <ul class="pagination"></ul>
                        </td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
            <div class="tab-pane" id="tab-6">
              <div class="p-a-md dker _600">Fibu</div>
              <form role="form" action="/contracts/edit/fibu" class="p-a-md" method="post">

                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-3 form-control-label">Price</label>
                      <div class="col-md-9">
                        <input type="text" class="form-control" name="price" value="{{contract.fibu.price}}">
                      </div>
                    </div>   
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-3 form-control-label">Ordering Month</label>
                      <div class='input-group date col-sm-9' ui-jp="datetimepicker" ui-options="{
                            format: 'DD-MM-YYYY',
                            icons: {
                              time: 'fa fa-clock-o',
                              date: 'fa fa-calendar',
                              up: 'fa fa-chevron-up',
                              down: 'fa fa-chevron-down',
                              previous: 'fa fa-chevron-left',
                              next: 'fa fa-chevron-right',
                              today: 'fa fa-screenshot',
                              clear: 'fa fa-trash',
                              close: 'fa fa-remove'
                            }
                          }">
                        <input type='text' class="form-control" name="ordering_month" value="{{contract.fibu.ordering_month | date('d-m-Y')}}">
                        <span class="input-group-addon">
                            <span class="fa fa-calendar"></span>
                        </span>
                      </div>
                    </div>   
                  </div>
                </div>

                <div class="form-group row">
                  <label class="col-md-3 form-control-label">Status</label>
                  <div class="col-md-9">
                    <input type="text" class="form-control" name="status" value="{{contract.fibu.status}}">
                  </div>
                </div>

                <input type="hidden" name="contract_id" value="{{contract.id}}">
                <button type="submit" class="btn btn-info m-t">Update</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- ############ PAGE END-->

<!-- ############ Modal Begin-->
<div id="edit-permission" class="modal" data-backdrop="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
    <form id="form" action="/contracts/edit/permission" method="post" >
      <div class="modal-header">
        <h5 class="modal-title">Edit Permission</h5>
      </div>
      <div class="modal-body">
        
        <div class="form-group row">
          <label class="col-md-1 form-control-label">Type</label>
          <div class="col-md-11">
            <select class="form-control c-select" id="tpye" name="type">
              <option value="BAZ">BAZ</option>
              <option value="VAZ">VAZ</option>
              <option value="VBA">VBA</option>
            </select>
          </div>
        </div>   
        
        <div class="form-group row">
          <label class="col-sm-3 form-control-label">Doc Delivery</label>
          <div class='input-group date col-sm-9' ui-jp="datetimepicker" ui-options="{
                    format: 'DD-MM-YYYY',
                    icons: {
                      time: 'fa fa-clock-o',
                      date: 'fa fa-calendar',
                      up: 'fa fa-chevron-up',
                      down: 'fa fa-chevron-down',
                      previous: 'fa fa-chevron-left',
                      next: 'fa fa-chevron-right',
                      today: 'fa fa-screenshot',
                      clear: 'fa fa-trash',
                      close: 'fa fa-remove'
                    }
                  }">
            <input type='text' class="form-control" id="doc_delivery" name="doc_delivery">
            <span class="input-group-addon">
              <span class="fa fa-calendar"></span>
            </span>
          </div>
        </div>  

        <div class="form-group row">
          <label class="col-sm-3 form-control-label">Permission Begin</label>
          <div class='input-group date col-sm-9' ui-jp="datetimepicker" ui-options="{
                    format: 'DD-MM-YYYY',
                    icons: {
                      time: 'fa fa-clock-o',
                      date: 'fa fa-calendar',
                      up: 'fa fa-chevron-up',
                      down: 'fa fa-chevron-down',
                      previous: 'fa fa-chevron-left',
                      next: 'fa fa-chevron-right',
                      today: 'fa fa-screenshot',
                      clear: 'fa fa-trash',
                      close: 'fa fa-remove'
                    }
                  }">
            <input type='text' class="form-control" id="begin" name="begin">
            <span class="input-group-addon">
              <span class="fa fa-calendar"></span>
            </span>
          </div>
        </div>

        <div class="form-group row">
          <label class="col-sm-3 form-control-label">Permission End</label>
          <div class='input-group date col-sm-9' ui-jp="datetimepicker" ui-options="{
                    format: 'DD-MM-YYYY',
                    icons: {
                      time: 'fa fa-clock-o',
                      date: 'fa fa-calendar',
                      up: 'fa fa-chevron-up',
                      down: 'fa fa-chevron-down',
                      previous: 'fa fa-chevron-left',
                      next: 'fa fa-chevron-right',
                      today: 'fa fa-screenshot',
                      clear: 'fa fa-trash',
                      close: 'fa fa-remove'
                    }
                  }">
            <input type='text' class="form-control" id="end" name="end">
            <span class="input-group-addon">
              <span class="fa fa-calendar"></span>
            </span>
          </div>
        </div>

        <div class="form-group row">
          <label class="col-md-1 form-control-label">Cost</label>
          <div class="col-md-11">
            <input type="text" class="form-control" id="cost" name="cost"> 
          </div>
        </div>   

        <div class="form-group row">
          <label class="col-md-1 form-control-label">Status</label>
          <div id="per_status" class="col-md-11 progress mb-4">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <input type="hidden" name="contract_id" value="{{contract.id}}">
        <input type="hidden" id="permission_id" name="permission_id" value="">
        <input type="hidden" name="project_id" value="{{project_id}}">
        <input type="hidden" name="project_adr" value="{{project_adr}}">
        <button type="button" class="btn dark-white p-x-md" data-dismiss="modal">Cancel</button>
        <button type="submit" class="btn danger p-x-md">Submit</button>
      </div>
    </form>
    </div><!-- /.modal-content -->
  </div>
</div>

<div id="edit-invocie" class="modal" data-backdrop="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
    <form id="form" action="/contracts/edit/invocie" method="post" >
      <div class="modal-header">
        <h5 class="modal-title">New Invocie</h5>
      </div>
      <div class="modal-body">
        
        <div class="form-group row">
          <label class="col-md-1 form-control-label">Invoice Nr.</label>
          <div class="col-md-11">
            <input type="text" class="form-control" id="rechnung_nr" name="rechnung_nr">
          </div>
        </div>  

         <div class="form-group row">
          <label class="col-md-1 form-control-label">Current Value</label>
          <div class="col-md-11">
            <input type="text" class="form-control" id="current_value" name="current_value">
          </div>
        </div>   
        <div class="form-group row">
          <label class="col-md-1 form-control-label">Sum Value</label>
          <div class="col-md-11">
            <input type="text" class="form-control" id="sum" name="sum">
          </div>
        </div>   
       
        <div class="form-group row">
          <label class="col-sm-3 form-control-label">Invocie Send</label>
          <div class='input-group date col-sm-9' ui-jp="datetimepicker" ui-options="{
                    format: 'DD-MM-YYYY',
                    icons: {
                      time: 'fa fa-clock-o',
                      date: 'fa fa-calendar',
                      up: 'fa fa-chevron-up',
                      down: 'fa fa-chevron-down',
                      previous: 'fa fa-chevron-left',
                      next: 'fa fa-chevron-right',
                      today: 'fa fa-screenshot',
                      clear: 'fa fa-trash',
                      close: 'fa fa-remove'
                    }
                  }">
            <input type='text' class="form-control" id="aufmass_am" name="aufmass_am">
            <span class="input-group-addon">
              <span class="fa fa-calendar"></span>
            </span>
          </div>
        </div>  

        <div class="form-group row">
          <label class="col-sm-3 form-control-label">Invocie Permitted</label>
          <div class='input-group date col-sm-9' ui-jp="datetimepicker" ui-options="{
                    format: 'DD-MM-YYYY',
                    icons: {
                      time: 'fa fa-clock-o',
                      date: 'fa fa-calendar',
                      up: 'fa fa-chevron-up',
                      down: 'fa fa-chevron-down',
                      previous: 'fa fa-chevron-left',
                      next: 'fa fa-chevron-right',
                      today: 'fa fa-screenshot',
                      clear: 'fa fa-trash',
                      close: 'fa fa-remove'
                    }
                  }">
            <input type='text' class="form-control" id="bewert_aufmass" name="bewert_aufmass">
            <span class="input-group-addon">
              <span class="fa fa-calendar"></span>
            </span>
          </div>
        </div>

        <div class="form-group row">
          <label class="col-sm-3 form-control-label">Permission End</label>
          <div class='input-group date col-sm-9' ui-jp="datetimepicker" ui-options="{
                    format: 'DD-MM-YYYY',
                    icons: {
                      time: 'fa fa-clock-o',
                      date: 'fa fa-calendar',
                      up: 'fa fa-chevron-up',
                      down: 'fa fa-chevron-down',
                      previous: 'fa fa-chevron-left',
                      next: 'fa fa-chevron-right',
                      today: 'fa fa-screenshot',
                      clear: 'fa fa-trash',
                      close: 'fa fa-remove'
                    }
                  }">
            <input type='text' class="form-control" id="end" name="end">
            <span class="input-group-addon">
              <span class="fa fa-calendar"></span>
            </span>
          </div>
        </div>

        <div class="form-group row">
          <label class="col-sm-3 form-control-label">Invocie Paid</label>
          <div class='input-group date col-sm-9' ui-jp="datetimepicker" ui-options="{
                    format: 'DD-MM-YYYY',
                    icons: {
                      time: 'fa fa-clock-o',
                      date: 'fa fa-calendar',
                      up: 'fa fa-chevron-up',
                      down: 'fa fa-chevron-down',
                      previous: 'fa fa-chevron-left',
                      next: 'fa fa-chevron-right',
                      today: 'fa fa-screenshot',
                      clear: 'fa fa-trash',
                      close: 'fa fa-remove'
                    }
                  }">
            <input type='text' class="form-control" id="guts_datum" name="guts_datum">
            <span class="input-group-addon">
              <span class="fa fa-calendar"></span>
            </span>
          </div>
        </div>

        <div class="form-group row">
          <label class="col-md-1 form-control-label">Status</label>
          <div id="per_status" class="col-md-11 progress mb-4">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <input type="hidden" name="contract_id" value="{{contract.id}}">
        <input type="hidden" id="invocie_id" name="invocie_id" value="">
        <input type="hidden" name="project_id" value="{{project_id}}">
        <input type="hidden" name="project_adr" value="{{project_adr}}">        
        <button type="button" class="btn dark-white p-x-md" data-dismiss="modal">Cancel</button>
        <button type="submit" class="btn danger p-x-md">Submit</button>
      </div>
    </form>
    </div><!-- /.modal-content -->
  </div>
</div>

<div id="del-item" class="modal" data-backdrop="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Delete</h5>
      </div>
      <div class="modal-body text-center p-lg">
        <p>Are you sure to delete : <span id="delitemtitle" style="font-weight:bold"></span>?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn dark-white p-x-md" data-dismiss="modal">No</button>
        <a type="button" class="btn danger p-x-md">Yes</a>
      </div>
    </div><!-- /.modal-content -->
  </div>
</div>
<!-- ############ Modal End-->


<script type="text/javascript">

// Attach a submit handler to the form
$("form").submit(function( event ) {
  // Get some values from elements on the page:
  url = $(this).attr( "action" );
  if (url != '/contracts/edit/permission' && url !='/contracts/edit/invocie'){
    // Stop form from submitting normally
    event.preventDefault();
   
    // Send the data using post
    var posting = $.post( url, $(this).serialize() );
   
    // Put the results in a div
    posting.done(function( data ) {
      bootbox.alert(data);
    });  
  }
});

$('#edit-permission').on('show.bs.modal', function(e) {
    $(this).find('form')[0].reset();
    var permission = $(e.relatedTarget).data('permission');
    if (permission) {
      $("#tpye").val(permission.type);
      $("#doc_delivery").val(moment(permission.doc_delivery).format("DD-MM-YYYY"));
      $("#begin").val(moment(permission.begin).format("DD-MM-YYYY"));
      $("#end").val(moment(permission.end).format("DD-MM-YYYY"));
      $("#cost").val(permission.cost);
      $("#permission_id").val(permission._id);
    }
  });

$('#edit-invocie').on('show.bs.modal', function(e) {
    $(this).find('form')[0].reset();
    var invocie = $(e.relatedTarget).data('invocie');
    if (invocie) {
      $("#rechnung_nr").val(invocie.rechnung_nr);
      $("#current_value").val(invocie.current_value);
      $("#sum").val(invocie.sum);
      $("#aufmass_am").val(moment(invocie.aufmass_am).format("DD-MM-YYYY"));
      $("#bewert_aufmass").val(moment(invocie.bewert_aufmass).format("DD-MM-YYYY"));
      $("#end").val(moment(invocie.end).format("DD-MM-YYYY"));
      $("#guts_datum").val(moment(invocie.guts_datum).format("DD-MM-YYYY"));
      $("#invocie_id").val(invocie._id);
    }
  });

$('#del-item').on('show.bs.modal', function(e) {
      $("#delitemtitle").html($(e.relatedTarget).data('item-tilte'));
      $(this).find('.danger').attr('href', $(e.relatedTarget).data('href'));
  });

$("#procent_completion").append('<div class="progress-bar progress-bar-striped progress-bar-animated primary" style="width: 0%">0%</div>');

$("#building_status").on('change', function() {
  $("#procent_completion").empty();
  switch(this.value) {
    case '00':
      $("#procent_completion").append('<div class="progress-bar progress-bar-striped progress-bar-animated primary" style="width: 0%">0%</div>');
      break;
    case '01':
      $("#procent_completion").append('<div class="progress-bar progress-bar-striped progress-bar-animated primary" style="width: 10%">10%</div>');
      break;
    case '02':
      $("#procent_completion").append('<div class="progress-bar progress-bar-striped progress-bar-animated primary" style="width: 80%">80%</div>');
      break;
    case '03':
      $("#procent_completion").append('<div class="progress-bar progress-bar-striped progress-bar-animated primary" style="width: 100%">100%</div>');
      break;
    case '04':
      $("#procent_completion").append('<div class="progress-bar progress-bar-striped progress-bar-animated primary" style="width: 100%">100%</div>');
      break;
  }
});

$("#is_acceptanced").on('change', function() {
  if($(this).is(":checked")) {
    $("#add_acceptance").append('<div class="col-sm-6">'+
                    '<div class="form-group row">'+
                     ' <label class="col-sm-2 form-control-label">applied</label>'+
                      '<div class="col-sm-10">'+
                        '<div class=\'input-group date col-sm-9\' ui-jp="datetimepicker" ui-options="{'+
                           ' icons: {'+
                            '  time: \'fa fa-clock-o\','+
                             ' date: \'fa fa-calendar\','+
                            '  up: \'fa fa-chevron-up\','+
                            '  down: \'fa fa-chevron-down\','+
                            '  previous: \'fa fa-chevron-left\','+
                            '  next: \'fa fa-chevron-right\','+
                            '  today: \'fa fa-screenshot\','+
                            '  clear: \'fa fa-trash\','+
                            '  close: \'fa fa-remove\''+
                            '}'+
                          '}">'+
                        '<input type=\'text\' class="form-control" name="applied">'+
                        '<span class="input-group-addon">'+
                        '    <span class="fa fa-calendar"></span>'+
                        '</span>'+
                      '</div>  '+
                     ' </div>'+
                   ' </div> '+
                   ' </div> '+
                   '<div class="col-sm-6">'+
                   ' <div class="form-group row">'+
                   '   <label class="col-sm-2 form-control-label">granted</label>'+
                   '   <div class="col-sm-10">'+
                   '     <div class=\'input-group date col-sm-9\' ui-jp="datetimepicker" ui-options="{'+
                   '         icons: {'+
                   '           time: \'fa fa-clock-o\','+
                   '           date: \'fa fa-calendar\','+
                   '           up: \'fa fa-chevron-up\','+
                   '           down: \'fa fa-chevron-down\','+
                   '           previous: \'fa fa-chevron-left\','+
                   '           next: \'fa fa-chevron-right\','+
                   '           today: \'fa fa-screenshot\','+
                   '           clear: \'fa fa-trash\','+
                   '           close: \'fa fa-remove\''+
                   '         }'+
                   '       }">'+
                   '     <input type=\'text\' class="form-control" name="granted">'+
                   '     <span class="input-group-addon">'+
                   '         <span class="fa fa-calendar"></span>'+
                   '     </span>'+
                   '   </div> '+
                   '   </div>'+
                   ' </div> '+
                  '</div>');
  } else {
    $("#add_acceptance").empty();
  }
});

$("#is_extern_company").on('change', function() {
  if($(this).is(":checked")) {
    $("#add_extern_company").append('<div class="col-sm-6">'+
                    '<div class="form-group row">'+
                     ' <label class="col-sm-2 form-control-label">name</label>'+
                      '<div class="col-sm-10">'+
                        '<input type=\'text\' class="form-control" name="company_name">'+
                      '</div>  '+
                     ' </div>'+
                   ' </div> '+
                   ' </div> '+
                   '<div class="col-sm-6">'+
                   ' <div class="form-group row">'+
                   '   <label class="col-sm-2 form-control-label">price</label>'+
                   '   <div class="col-sm-10">'+
                   '     <input type=\'text\' class="form-control" name="price">'+
                   '   </div> '+
                   '   </div>'+
                   ' </div> '+
                  '</div>');
  } else {
    $("#add_extern_company").empty();
  }
});


function calStatusOfBuilding() {
  if (moment($("#plan_begin").val(), "DD-MM-YYYY", true).isValid()  && moment($("#plan_end").val(), "DD-MM-YYYY", true).isValid() ) {
    var now = moment();
    var building_begin = moment($("#plan_begin").val(),"DD-MM-YYYY");
    var building_end = moment($("#plan_end").val(),"DD-MM-YYYY");

    console.log($("#plan_end").val());

    if (now.isAfter(building_end)) {
      $("#building_status").val('03');
    } else if (now.isAfter(building_begin)) {
      $("#building_status").val('02');
    }
  } else {
    $("#building_status").val('01');
  }

  $("#building_status").change();
}

calStatusOfBuilding();

$('#plan_end_div').on('dp.change', function (ev) {
    calStatusOfBuilding();
});

$(document).ready(function() {
  {% if jump_building_permission %}
    bootbox.alert('update building_permission done!');
    $('#building_permission')[0].click();
  {% endif %}
  {% if jump_financial %}
    bootbox.alert('update invocie done!');
    $('#financial')[0].click();
  {% endif %}
});
</script>
{% endblock %}
